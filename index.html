<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>不老松中清店管理系統</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 核心 (UMD 版本，不依賴 import) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel 實時編譯器 -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase 相容性 SDK (UMD 版本) -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; margin: 0; padding: 0; }
        
        @media print {
            @page { size: A4 portrait; margin: 0; }
            html, body { height: 100%; margin: 0 !important; padding: 0 !important; overflow: hidden; }
            body { background: white; -webkit-print-color-adjust: exact; }
            .print-area { 
                width: 100% !important; 
                height: 100vh !important; 
                max-height: 100vh !important; 
                border: 2px solid black !important; 
                margin: 0 !important; 
                display: flex; 
                flex-direction: column; 
                box-sizing: border-box; 
            }
            table { width: 100% !important; flex: 1; table-layout: fixed; border-collapse: collapse; }
            tr { page-break-inside: avoid; height: auto !important; }
            th, td { padding: 0 !important; line-height: 1 !important; vertical-align: middle; border: 1px solid #333; text-align: center; }
            .print-hidden { display: none !important; }
            input { border: none !important; box-shadow: none !important; padding: 0 !important; margin: 0 !important; background: transparent !important; }
            nav, footer, .control-btn, .stat-box, .manager-tools, .edit-supervisors, .staff-editor, .loading-overlay { display: none !important; }
            .slot-input { font-size: 13px !important; font-weight: 900 !important; width: 100% !important; }
            .header-info { padding: 4px !important; background: #f3f4f6 !important; }
        }

        .slot-input:focus { background-color: #f1f5f9; outline: none; }
        .control-btn { opacity: 0.1; transition: all 0.2s; cursor: pointer; }
        td:hover .control-btn { opacity: 1; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }
        .interview-box { cursor: pointer; transition: all 0.1s; border: 1px solid #f1f5f9; }
        .interview-box:hover { background-color: #f1f5f9; }
        .single-view-container { max-height: calc(100vh - 220px); overflow-y: auto; }
        
        .loading-overlay { position: fixed; inset: 0; background: #fff; display: flex; justify-content: center; items-center; z-index: 9999; flex-direction: column; gap: 15px; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #4f46e5; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // 確保從全域物件獲取庫，避免模組載入問題
        const { useState, useMemo, useEffect } = window.React;
        const firebase = window.firebase;

        // --- 預設資料配置 ---
        const PRESET_2026_HOLIDAYS = [
            { date: "2026-01-01", name: "元旦" },
            { date: "2026-02-14", name: "除夕" },
            { date: "2026-02-15", name: "初一" },
            { date: "2026-02-16", name: "初二" },
            { date: "2026-02-17", name: "初三" },
            { date: "2026-02-18", name: "初四" },
            { date: "2026-02-19", name: "初五" },
            { date: "2026-02-20", name: "春節連假" },
            { date: "2026-02-21", name: "春節連假" },
            { date: "2026-02-22", name: "春節連假" },
            { date: "2026-02-28", name: "和平紀念日" },
            { date: "2026-04-04", name: "兒童節" },
            { date: "2026-04-05", name: "清明節" },
            { date: "2026-05-01", name: "勞動節" },
            { date: "2026-06-19", name: "端午節" },
            { date: "2026-09-25", name: "中秋節" },
            { date: "2026-10-10", name: "國慶日" }
        ];

        const PRESET_COLORS = {
            "05": "#3B82F6", "58": "#3B82F6", "69": "#3B82F6",
            "03": "#EF4444", "06": "#EF4444", "07": "#EF4444", "11": "#EF4444", "18": "#EF4444", 
            "20": "#EF4444", "27": "#EF4444", "32": "#EF4444", "33": "#EF4444", "35": "#EF4444", 
            "37": "#EF4444", "39": "#EF4444", "57": "#EF4444", "60": "#EF4444", "62": "#EF4444", 
            "65": "#EF4444", "66": "#EF4444", "68": "#EF4444", "76": "#EF4444", "77": "#EF4444", 
            "80": "#EF4444", "88": "#EF4444", "89": "#EF4444", "90": "#EF4444",
            "02": "#000000", "08": "#000000", "09": "#000000", "10": "#000000", "16": "#000000", 
            "17": "#000000", "22": "#000000", "25": "#000000", "28": "#000000", "30": "#000000", 
            "31": "#000000", "38": "#000000", "52": "#000000", "53": "#000000", "55": "#000000", 
            "59": "#000000", "67": "#000000", "70": "#000000", "79": "#000000", "81": "#000000", 
            "82": "#000000", "83": "#000000", "86": "#000000", "91": "#000000", "93": "#000000", 
            "96": "#000000", "97": "#000000", "98": "#000000", "99": "#000000", "100": "#000000", "101": "#000000"
        };

        const INITIAL_STATE = {
            holidays: PRESET_2026_HOLIDAYS,
            colorMap: PRESET_COLORS,
            counterStaff: ["行政 A", "行政 B"],
            supervisorList: [
                { id: 'A', color: "#9333EA", label: "世傑" }, 
                { id: 'B', color: "#DB2777", label: "信吉" },
                { id: 'C', color: "#0891B2", label: "麥麥" }, 
                { id: 'D', color: "#EA580C", label: "蕾蕾" },
                { id: 'E', color: "#65A30D", label: "楷翔" }, 
                { id: 'F', color: "#4F46E5", label: "小汝" }
            ]
        };

        // --- Firebase 初始化 ---
        const configStr = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
        const firebaseConfig = JSON.parse(configStr);
        
        // 防止重複初始化
        let app;
        if (!firebase.apps.length) {
            app = firebase.initializeApp(firebaseConfig);
        } else {
            app = firebase.app();
        }
        
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'unlaosong-v17';

        const App = () => {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('B');
            const [year, setYear] = useState(2026);
            const [month, setMonth] = useState(2);
            const [isInitialLoad, setIsInitialLoad] = useState(true);

            const [settings, setSettings] = useState(INITIAL_STATE);
            const [schedule, setSchedule] = useState({});
            const [interview, setInterview] = useState({});

            const monthKey = `${year}-${month}`;

            // --- 認證流程 ---
            useEffect(() => {
                const initAuth = async () => {
                    try {
                        const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                        if (token) {
                            await auth.signInWithCustomToken(token);
                        } else {
                            await auth.signInAnonymously();
                        }
                    } catch (err) {
                        console.error("Firebase Auth Error:", err);
                        // 本地測試時若無配置，強制結束載入畫面以便看到介面
                        setIsInitialLoad(false);
                    }
                };
                initAuth();
                const unsub = auth.onAuthStateChanged(u => { if(u) setUser(u); });
                return () => unsub();
            }, []);

            // --- 資料同步 ---
            useEffect(() => {
                if (!user) return;
                const setRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('settings').doc('global');
                const unsub = setRef.onSnapshot(snap => {
                    if (snap.exists) {
                        setSettings(snap.data());
                    } else {
                        setRef.set(INITIAL_STATE);
                    }
                    setIsInitialLoad(false);
                }, () => setIsInitialLoad(false));
                return () => unsub();
            }, [user]);

            useEffect(() => {
                if (!user) return;
                const dataRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('monthlyData').doc(monthKey);
                const unsub = dataRef.onSnapshot(snap => {
                    if (snap.exists) {
                        const d = snap.data();
                        setSchedule(d.schedule || {});
                        setInterview(d.interview || {});
                    } else {
                        setSchedule({});
                        setInterview({});
                    }
                });
                return () => unsub();
            }, [user, monthKey]);

            const pushS = (val) => db.collection('artifacts').doc(appId).collection('public').doc('data').collection('settings').doc('global').set(val);
            const pushD = (sch, int) => db.collection('artifacts').doc(appId).collection('public').doc('data').collection('monthlyData').doc(monthKey).set({ schedule: sch, interview: int });

            const stats = useMemo(() => {
                const ids = Object.values(schedule).flat().map(v => v.trim()).filter(Boolean);
                const masters = Object.keys(settings.colorMap);
                const missing = masters.filter(id => !new Set(ids).has(id)).sort((a,b)=>parseInt(a)-parseInt(b));
                const sCount = {};
                settings.supervisorList.forEach(s => sCount[s.color] = 0);
                let mCount = 0, cCount = 0;
                Object.keys(interview).forEach(id => {
                    const col = interview[id];
                    if(sCount.hasOwnProperty(col)) sCount[col]++;
                    if(masters.includes(id)) mCount++;
                    else if(settings.counterStaff.includes(id)) cCount++;
                });
                return { missing, total: mCount + cCount, mCount, cCount, sCount };
            }, [schedule, settings, interview]);

            const [brush, setBrush] = useState(INITIAL_STATE.supervisorList[0].color);

            if (isInitialLoad) return <div className="loading-overlay"><div className="spinner"></div><p className="font-bold text-indigo-600 italic tracking-widest">不老松管理系統載入中...</p></div>;

            return (
                <div className="min-h-screen flex flex-col">
                    <nav className="bg-white shadow px-6 py-2 flex items-center justify-between sticky top-0 z-50 print-hidden border-b">
                        <div className="flex items-center gap-4">
                            <h1 className="text-lg font-black text-slate-800 tracking-tighter uppercase font-serif">不老松中清店</h1>
                            <div className="flex bg-slate-100 p-1 rounded-lg text-xs font-bold shadow-inner">
                                {['A', 'B', 'C', 'D'].map(tab => (
                                    <button key={tab} onClick={() => setActiveTab(tab)} className={`px-4 py-1.5 rounded transition-all ${activeTab === tab ? 'bg-white shadow text-indigo-600' : 'text-slate-500 hover:text-slate-800'}`}>
                                        {tab==='A'?'國定假日':tab==='B'?'排班主表':tab==='C'?'師傅顏色':'訪談標記'}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div className="text-xs font-bold text-slate-400 font-mono flex items-center gap-2">
                            <select value={year} onChange={e=>setYear(parseInt(e.target.value))} className="bg-transparent border-none outline-none cursor-pointer hover:text-indigo-600 font-black">
                                {[2025, 2026, 2027].map(y => <option key={y} value={y}>{y}</option>)}
                            </select>
                            <span className="opacity-50">/</span>
                            <select value={month} onChange={e=>setMonth(parseInt(e.target.value))} className="bg-transparent border-none outline-none cursor-pointer hover:text-indigo-600 font-black">
                                {[...Array(12)].map((_, i) => <option key={i+1} value={i+1}>{String(i+1).padStart(2, '0')}</option>)}
                            </select>
                        </div>
                    </nav>

                    <main className="flex-1 max-w-7xl mx-auto w-full p-4 mb-10 overflow-hidden">
                        {activeTab === 'A' && (
                            <div className="bg-white p-6 rounded-xl border shadow-sm animate-fadeIn">
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2 tracking-widest">2026 國定假日管理</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div className="bg-slate-50 p-4 rounded-lg border">
                                        <h3 className="text-sm font-bold text-slate-500 mb-4 uppercase">新增或編輯假日</h3>
                                        <div className="space-y-3">
                                            <input id="hn" className="w-full border p-2 rounded text-sm font-bold outline-none" placeholder="節日名稱" />
                                            <input id="hd" type="date" className="w-full border p-2 rounded text-sm font-mono" />
                                            <button onClick={()=>{
                                                const n=document.getElementById('hn').value, d=document.getElementById('hd').value;
                                                if(n&&d){ const next={...settings, holidays:[...settings.holidays.filter(x=>x.date!==d), {date:d, name:n}]}; setSettings(next); pushS(next); }
                                            }} className="w-full bg-indigo-600 text-white py-2 rounded font-black shadow hover:bg-indigo-700 transition-colors">儲存至雲端</button>
                                        </div>
                                    </div>
                                    <div className="max-h-[60vh] overflow-y-auto custom-scrollbar border rounded p-2 bg-white">
                                        {settings.holidays.sort((a,b)=>a.date.localeCompare(b.date)).map(h => (
                                            <div key={h.date} className="py-2 px-3 border-b flex justify-between group hover:bg-red-50 transition-all">
                                                <span className="font-mono text-sm font-bold">{h.date} <span className="text-red-500 ml-4 font-black">{h.name}</span></span>
                                                <button onClick={()=>{const next={...settings, holidays:settings.holidays.filter(x=>x.date!==h.date)}; setSettings(next); pushS(next);}} className="text-red-300 opacity-0 group-hover:opacity-100 hover:text-red-600 font-black">✕</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'B' && (
                            <div className="animate-fadeIn">
                                <div className="flex justify-between items-end mb-4 print-hidden">
                                    <div className="flex-1">
                                        <h2 className="font-black text-slate-800 text-lg uppercase tracking-wider mb-2">排班主表</h2>
                                        <div className="bg-amber-50 border border-amber-200 px-4 py-2 rounded shadow-sm text-sm">
                                            <span className="font-black text-amber-900 mr-2 underline">未排號碼盤點：</span>
                                            <span className="font-mono text-amber-700 font-bold break-all leading-relaxed">{stats.missing.join(', ') || '✅ 所有人員皆已排入'}</span>
                                        </div>
                                    </div>
                                    <button onClick={()=>window.print()} className="bg-slate-800 text-white px-8 py-3 rounded-full text-sm font-black shadow-xl hover:bg-black transition-all active:scale-95 ml-6">列印 A4</button>
                                </div>
                                <div className="print-area bg-white border-2 border-slate-900 mx-auto overflow-hidden shadow-2xl">
                                    <div className="flex border-b border-slate-900 font-bold p-1 bg-white items-center header-info">
                                        <div className="w-24 border-r border-slate-900 text-[10px] flex justify-center font-black">不老松中清店</div>
                                        <div className="flex-1 text-center text-base tracking-[0.2em] font-black uppercase"><span className="text-orange-600">{month}月</span>無法排班表</div>
                                    </div>
                                    <table className="w-full border-collapse text-[10px] table-fixed">
                                        <thead><tr className="bg-slate-50 border-b border-slate-900 font-bold uppercase tracking-tighter">
                                            <th className="border-r w-8 py-1 text-center">日</th><th className="border-r w-12 text-center">週</th>
                                            <th className="border-r bg-blue-50/50 w-[30%]">早班 (08-11)</th>
                                            <th className="border-r bg-red-50/50 w-[30%]">午班 (12-17)</th>
                                            <th className="bg-green-50/50 w-[30%]">夜班 (18-20)</th>
                                        </tr></thead>
                                        <tbody>
                                            {Array.from({length: new Date(year, month, 0).getDate()}, (_,i)=>i+1).map(day => {
                                                const dObj = new Date(year, month-1, day);
                                                const dStr = `${year}-${String(month).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                                                const h = settings.holidays.find(x=>x.date===dStr);
                                                const isH = !!h || dObj.getDay()===0 || dObj.getDay()===6;
                                                const clr = isH ? 'text-red-600' : 'text-slate-800';
                                                return (
                                                    <tr key={day} className="border-b h-[24px]">
                                                        <td className={`border-r text-center font-black ${clr}`}>{day}</td>
                                                        <td className={`border-r text-center ${clr} flex flex-col justify-center leading-none h-full`}>
                                                            <div className="text-[10px] font-bold">({['日','一','二','三','四','五','六'][dObj.getDay()]})</div>
                                                            {h && <div className="text-[6px] scale-[0.6] font-black leading-tight truncate">{h.name}</div>}
                                                        </td>
                                                        {['early', 'middle', 'late'].map((shift, idx) => (
                                                            <td key={shift} className={`p-0 border-r ${idx===2?'border-r-0':''} ${shift==='early'?'bg-blue-50/5':shift==='middle'?'bg-red-50/5':'bg-green-50/5'}`}>
                                                                <div className="grid grid-cols-8 h-full relative group">
                                                                    {(schedule[`${day}-${shift}`] || Array(8).fill('')).map((v, sIdx) => (
                                                                        <input key={sIdx} className="w-full h-full text-center font-black text-sm outline-none slot-input border-r border-slate-100 last:border-r-0" style={{ color: settings.colorMap[v.trim()] || '#000' }} value={v} onChange={e => {
                                                                            const key=`${day}-${shift}`; const slots = schedule[key] || Array(8).fill('');
                                                                            const next=[...slots]; next[sIdx]=e.target.value; const nextSch={...schedule,[key]:next};
                                                                            setSchedule(nextSch); pushD(nextSch, interview);
                                                                        }} />
                                                                    ))}
                                                                </div>
                                                            </td>
                                                        ))}
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'C' && (
                            <div className="bg-white p-6 rounded-xl border shadow-sm animate-fadeIn h-full overflow-y-auto custom-scrollbar">
                                <div className="flex justify-between items-center mb-6 border-b pb-4"><h2 className="text-2xl font-black text-slate-800 uppercase tracking-widest">師傅配色管理</h2><div className="bg-indigo-600 px-4 py-2 rounded-lg text-white shadow-lg flex flex-col items-end"><span className="text-[10px] font-bold uppercase opacity-80 tracking-widest">師傅總量</span><span className="text-xl font-black">{Object.keys(settings.colorMap).length} 位</span></div></div>
                                <div className="grid grid-cols-4 md:grid-cols-8 lg:grid-cols-10 gap-3 text-center">
                                    {Object.entries(settings.colorMap).sort((a,b)=>parseInt(a[0])-parseInt(b[0])).map(([id, color]) => (
                                        <div key={id} className="p-2 border rounded-xl bg-white shadow-sm hover:scale-110 transition-all border-slate-100">
                                            <span className="font-mono text-base font-black" style={{ color }}>{id}</span>
                                            <span className={`text-[8px] text-white px-1.5 rounded font-bold block mt-1 ${color==='#000'?'bg-slate-800':color==='#EF4444'?'bg-red-500':'bg-blue-500'}`}>{color==='#000'?'男':color==='#EF4444'?'女':'全'}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'D' && (
                            <div className="flex flex-col h-full animate-fadeIn gap-4">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 print-hidden">
                                    <div className="bg-white p-3 rounded-xl border shadow-sm flex flex-col justify-between">
                                        <h3 className="text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">主管名單維護</h3>
                                        <div className="grid grid-cols-2 gap-2">
                                            {settings.supervisorList.map((s, idx) => (
                                                <input key={s.id} value={s.label} onChange={e => {
                                                    const nextL=[...settings.supervisorList]; nextL[idx].label=e.target.value;
                                                    const nextS={...settings, supervisorList:nextL}; setSettings(nextS); pushS(nextS);
                                                }} className="text-[10px] border p-1 rounded font-bold outline-none focus:border-indigo-300 transition-all" style={{ borderLeft:`4px solid ${s.color}` }} />
                                            ))}
                                        </div>
                                    </div>
                                    <div className="bg-white p-3 rounded-xl border shadow-sm flex flex-col gap-2">
                                        <h3 className="text-xs font-black text-slate-400 uppercase tracking-widest">櫃台維護</h3>
                                        <input className="w-full border p-1 rounded text-xs font-bold outline-none focus:border-indigo-300" placeholder="按 Enter 新增人員" onKeyPress={e=>{ if(e.key==='Enter'&&e.target.value){ const nextS={...settings, counterStaff:[...settings.counterStaff, e.target.value]}; setSettings(nextS); pushS(nextS); e.target.value=""; }}} />
                                        <div className="flex flex-wrap gap-1 max-h-16 overflow-y-auto custom-scrollbar">
                                            {settings.counterStaff.map(n => <div key={n} className="bg-slate-50 border px-1.5 py-0.5 rounded text-[10px] flex items-center gap-1 font-bold">{n}<button onClick={()=>{const nextS={...settings, counterStaff:settings.counterStaff.filter(x=>x!==n)}; setSettings(nextS); pushS(nextS);}} className="text-red-400 hover:text-red-600 transition-colors pl-1">✕</button></div>)}
                                        </div>
                                    </div>
                                    <div className="bg-white p-3 rounded-xl border shadow-sm">
                                        <div className="flex justify-between mb-1"><span className="text-xs font-black text-slate-400 uppercase">筆刷選擇</span><span className="text-xs font-black text-indigo-600 bg-indigo-50 px-2 rounded">已完成: {stats.total} 位</span></div>
                                        <div className="grid grid-cols-6 gap-1">
                                            {settings.supervisorList.map(s => (
                                                <button key={s.id} onClick={()=>setBrush(s.color)} className={`py-1 rounded border-2 flex flex-col items-center transition-all ${brush===s.color?'border-slate-800 shadow-md scale-105':'opacity-30 border-transparent grayscale'}`} style={{ backgroundColor: s.color, color: 'white' }}>
                                                    <span className="text-[8px] font-black leading-none mb-1 truncate w-full">{s.label}</span>
                                                    <span className="text-[10px] font-black">{stats.sCount[s.color]}</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <div className="print-area bg-white border-2 border-slate-900 shadow-xl flex flex-col overflow-hidden max-h-screen">
                                    <div className="flex border-b border-slate-900 font-bold p-2 items-center justify-center gap-4 bg-white text-center">
                                        <span className="text-lg font-black uppercase text-indigo-700 tracking-widest">{month}月 員工績效訪談盤點報表</span>
                                    </div>
                                    <div className="single-view-container custom-scrollbar p-2">
                                        <div className="mb-2 bg-indigo-600 text-white text-[10px] font-black px-2 py-0.5 rounded-t inline-block shadow-sm">櫃台團隊 ({stats.cCount}/{settings.counterStaff.length})</div>
                                        <div className="grid grid-cols-5 bg-slate-50 border-t border-indigo-600 mb-4 shadow-inner border-b">
                                            {settings.counterStaff.map(n => (
                                                <div key={n} onClick={()=>{ const next={...interview}; if(next[n]===brush) delete next[n]; else next[n]=brush; setInterview(next); pushD(schedule,next); }} className="interview-box p-1.5 flex items-center justify-between border-r border-b border-slate-200" style={{ backgroundColor: interview[n]?`${interview[n]}11`:'' }}>
                                                    <span className="text-xs font-bold text-slate-700">{n}</span>
                                                    <div className="w-5 h-5 rounded border flex items-center justify-center bg-white shadow-sm" style={{ backgroundColor: interview[n] || 'white' }}>{interview[n] && <span className="text-white text-[8px] font-black">✓</span>}</div>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="bg-slate-800 text-white text-[10px] font-black px-2 py-0.5 rounded-t inline-block shadow-sm">師傅團隊 ({stats.mCount}/{Object.keys(settings.colorMap).length})</div>
                                        <div className="grid grid-cols-8 border-t border-slate-800 shadow-inner">
                                            {Object.keys(settings.colorMap).sort((a,b)=>parseInt(a)-parseInt(b)).map(id => (
                                                <div key={id} onClick={()=>{ const next={...interview}; if(next[id]===brush) delete next[id]; else next[id]=brush; setInterview(next); pushD(schedule,next); }} className="interview-box p-1 flex flex-col items-center border-r border-b border-slate-200 h-10 justify-center text-center" style={{ backgroundColor: interview[id]?`${interview[id]}11`:'' }}>
                                                    <span className="font-mono text-xs font-black" style={{ color: settings.colorMap[id] }}>{id}</span>
                                                    <div className="w-3 h-3 rounded-full border bg-white mt-0.5 shadow-inner" style={{ backgroundColor: interview[id] || 'white' }}></div>
                                                    {interview[id] && <span className="text-[6px] font-bold text-slate-500 mt-0.5 truncate w-full scale-90 leading-tight tracking-tighter">{settings.supervisorList.find(x=>x.color===interview[id])?.label}</span>}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="mt-auto border-t border-slate-900 bg-slate-50 p-2 flex justify-center gap-6 flex-wrap shadow-inner text-center">
                                        {settings.supervisorList.map(s => <div key={s.id} className="flex items-center gap-1.5 text-[10px] font-black text-slate-700"><div className="w-3 h-3 rounded-sm shadow-sm" style={{ backgroundColor: s.color }}></div>{s.label}: {stats.sCount[s.color]} 人</div>)}
                                        <div className="border-l border-slate-400 pl-6 font-black text-[10px] text-indigo-700">總訪談量：{stats.total} 位</div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <footer className="bg-white border-t p-2 text-center text-[10px] text-slate-400 print-hidden fixed bottom-0 w-full z-50 flex justify-center gap-6 shadow-md bg-opacity-90 backdrop-blur-sm">
                        <span className="uppercase tracking-widest font-black text-indigo-400 tracking-widest">© 原點數位科技 - 雲端管理系統</span>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
